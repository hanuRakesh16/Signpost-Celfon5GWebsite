{% extends 'base.html'%}
{% load static %}
{% load widget_tweaks %}
{% load crispy_forms_filters %}
{% block content %}
    <div class="container">
    <div class="row">
        <div class="col-md-12">
            <form id="idform" method="post" action="" enctype="multipart/form-data" data-cities-url="{% url 'ajax_load_cities' %}" data-cat-url="{% url 'ajax_load_cat' %}"
                      data-p-url="{% url 'ajax_load_p' %}">
                {% csrf_token %}
{#                {{ form|crispy }}#}
                <div class="row">
                        <h3 class="title text-center">Add Persons</h3>
                    <br/>
                        <hr>
                    <div class="col-lg-2 col-md-2 col-3">
                            <label>Prefix<span class="tt" data-bs-placement="top" title="Select appropriate prefix from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.prefix class="form-control" maxlength="45" type="text" id="prefix" %}
                    </div>
                    <div class="col-lg-7 col-md-7 col-9">
                            <label>Name*<span class="tt" data-bs-placement="top" title="Correct name in full. Type initals at the end. Do not use prefix like Mr., Dr etc">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.name class="form-control" maxlength="25" type="text" id="name" %}
                    </div>
                    <div class="col-lg-3 col-md-3 col-12">
                            <label>Profile Image*<span class="tt" data-bs-placement="top" title="Upload your Profile Image">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.logo class="form-control" type="file" id="logo" %}
                    </div>
                </div><br>
                <div class="row">
                        <div class="col-lg-4 col-md-4">
                            <label>Door No.<span class="tt" data-bs-placement="top" title="Do not type - D.No, Door No., # etc before the numbers">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.door_no class="form-control" maxlength="25" type="text" id="door" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Street Name*<span class="tt" data-bs-placement="top" title="use Abbreviations : St - Street, Rd - Road, Ln - Lane, Lo - Lane, Ngr -  Nagar etc">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.street_name class="form-control"  maxlength="25" type="text" id="street" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Building, Floor<span class="tt" data-bs-placement="top" title="Flat Number, Floor, Apartment Name in order. For Single Floor Bldgs, do not type Ground Floor">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.building_name class="form-control" maxlength="25" type="text" id="building" %}
                        </div>
                    </div><br>
                <div class="row">
                        <div class="col-lg-4 col-md-4">
                            <label>Area</label>
                            {% render_field form.area class="form-control" maxlength="45" type="text" id="locality" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Landmark<span class="tt" data-bs-placement="top" title="Use - Opp. (opposite), Nr (Near), Off etc with well known Land Mark / Street.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.landmark class="form-control" maxlength="25" type="text" id="landmark" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>City<span class="tt" data-bs-placement="top" title="Full correct name, as officialy known today. Do not type Pet name, abbreviations.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.city class="form-control" maxlength="45" type="text" id="city" %}
                        </div>
                    </div><br>
                <div class="row">
                        <div class="col-lg-4 col-md-4">
                            <label>State*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.state class="form-control" maxlength="45" type="text" id="state" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>District*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.district class="form-control"  maxlength="45" type="text" id="district" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Pincode<span class="tt" data-bs-placement="top" title="Type 6 digits continuously with out gap.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.pincode class="form-control" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" maxlength="6" type="number" id="pincode" %}
                        </div>
                    </div><br>
                {% comment %} <div class="row">
                        <div class="col-lg-6 col-md-6">
                            <label>Willingness to donate blood?</label>
                            {% render_field form.blood_donor class="form-control" type="text" id="donate" %}
                        </div>
                    <div class="col-lg-6 col-md-6">
                            <label>Blood Group*</label>
                            {% render_field form.blood_group class="form-control" maxlength="45" type="text" id="blood" %}
                        </div>
                </div><br> {% endcomment %}
                <div class="row">
                    <h3 class="title">Communication Details</h3>
                    <hr>
                    <div class="col-lg-12 col-md-12">
                            <label>Mobile*<span class="tt" data-bs-placement="top" title="Preferably Type Whats App Number. Type all 10+2 digits with out gap. Remember to add  (91) country code in the front.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.mobile_number class="form-control" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" maxlength="10" type="number" id="mobile" %}
                            <p class="er text-danger"></p>
                    </div>
                    <div class="col-lg-12 col-md-12">
                            <label>Email*<span class="tt" data-bs-placement="top" title="Type correctly.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.email class="form-control" maxlength="45" type="email" id="email" %}
                    </div>
                    <div class="col-lg-12 col-md-12">
                            <label>Website<span class="tt" data-bs-placement="top" title="Type correctly.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.website class="form-control" maxlength="45" type="text" id="website" %}
                    </div>
                </div><br>
                <div class="row">
                        <h3 class="title">Profile</h3>
                        <hr>
                        <div class="row details_div_row first_details">
                            <div class="col-lg-4 " >
                                <label>Profession*<span class="tt" data-bs-placement="top" title="Type in 2 or 3 words, the specific product or service name or select from drop-down. Prefer Product List if available.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                                {% render_field form.mproducts1 class="form-control product" name="mp1" type="text" id="id_products" %}
                            </div>

                            <div class="col-lg-4">
                                <label>Sub Category<span class="tt" data-bs-placement="top" title="Based on value typed for PRODUCT, this field is automatically filled. If not filled automatically, please select 'OTHERS'">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                                {% render_field form.msub_category1 class="form-control" name="msc1" type="text" id="id_sub_category" %}
                                <small id="Help" class="form-text text-muted">Select "Others" if not Automatically filled.</small>
                            </div>
                            <div class="col-lg-4">
                                <label>Category<span class="tt" data-bs-placement="top" title="Based on value typed for PRODUCT, this field is automatically filled. If not filled automatically, please select 'OTHERS'">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                                {% render_field form.mcategory1 class="form-control" name="mc1" type="text" id="id_category" %}
                                <small id="Help" class="form-text text-muted">Select "Others" if not Automatically filled.</small>
                            </div>
                            {% comment %} <div class="col-lg-3">
                                <label>Type</label>
                                {% render_field form.mtype1 class="form-control" name="mtype1" type="text" id="type1" %}
{#                                <small id="Help" class="form-text text-muted">Select "Others" if not Automatically filled.</small>#}
                            </div> {% endcomment %}
                        </div>
                        {% comment %} <div class="col-lg-12 col-md-12">
                            <label>Business Name<span class="tt" data-bs-placement="top" title="Type if you have any own business.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.name class="form-control" maxlength="255" type="text" id="altname" %}
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <label>Firm Type<span class="tt" data-bs-placement="top" title="Select from dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.firm_type class="form-control" maxlength="255" type="text" id="firmtype" %}
                        </div> {% endcomment %}
                        {% comment %} <div class="col-lg-12 col-md-12">
                            <label>Business Nature<span class="tt" data-bs-placement="top" title="Select from dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.nature class="form-control" maxlength="255" type="text" id="nature" %}
                        </div> {% endcomment %}
                        <div class="col-lg-12 col-md-12">
                            <label>About<span class="tt" data-bs-placement="top" title="Tell us something on you, your uniqueness, Awards, Recognitions etc.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.description class="form-control" maxlength="255" type="text" id="about" %}
                        </div>
                        
                    <div class="col-lg-4 col-md-4">
                            <label>Year of Birth*<span class="tt" data-bs-placement="top" title="Type 4 digits (YYYY)">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.year_of_birth class="form-control" maxlength="4" type="number" id="year_of_birth" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Gender<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.gender class="form-control" type="text" id="gender" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Martial Status*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.martial_status class="form-control" type="text" id="martial_status" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Education*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.education class="form-control" type="text" id="education" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Employement*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.employment class="form-control"   maxlength="45" type="text" id="employment" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Family Responsibility*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.responsibility class="form-control" type="text" id="responsibility" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Income*<span class="tt" data-bs-placement="top" title="Select from the dropdown.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.income class="form-control" type="text" id="income" %}
                        </div>
                    <div class="col-lg-4 col-md-4">
                            <label>Hobbies<span class="tt" data-bs-placement="top" title="Type nature of interest in life, hobbies etc">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.hobbies class="form-control" maxlength="200" type="text" id="hobbies" %}
                        </div>
                    <div class="col-lg-12 col-md-12">
                            <label>Business Card<span class="tt" data-bs-placement="top" title="Upload your visiting card id available.">
                                <i class="fa-solid fa-circle-question"></i>
                            </span></label>
                            {% render_field form.visiting_card class="form-control" maxlength="255" type="file" id="visiting_card" %}
                        </div>
                    </div><br>
                <button type="submit" class="btn btn-primary mb-5">Submit</button><br>
            </form>
        </div>
    </div>
</div>
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{% static 'assets/js/select2/dist/js/select2.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery-ui.min.js' %}"></script>
    <script src="{% static 'assets/js/validate/jquery.validate.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script>
        const tooltips = document.querySelectorAll('.tt')
        tooltips.forEach(t => {
          new bootstrap.Tooltip(t)
        })
      </script>
    <script>
    $("#state").change(function () {
            const url = $("#idform").attr("data-cities-url");  // get the url of the `load_cities` view
            const countryId = $(this).val();  // get the selected country ID from the HTML input

            $.ajax({                       // initialize an AJAX request
                url: url,                    // set the url of the request (= /persons/ajax/load-cities/ )
                data: {
                    'region_id': countryId       // add the country id to the GET parameters
                },
                success: function (data) {   // `data` is the return of the `load_cities` view function
                    $("#district").html(data);  // replace the contents of the city input with the data that came from the server
                }
            });
        });
    $('#mobile').keyup(function(){
    let data = $(this).val();
    let regx = /(0|91)?[6-9][0-9]{9}/;


    if ( data === '' || data.match(regx) ){
        $('.er').fadeOut('fast');
    }
    else {
        $('.er')
            .text('Enter valid mobile number')
            .css({'color':'#fff', 'padding':'3px'})
            .fadeIn('fast');
    }
});
     $(document).ready(function() {
		// validate signup form on keyup and submit
		$("#idform").validate({
			rules: {
				pincode: {
                    required: true,
                    minlength: 6 ,
                },
				mobile: {
                    required: true,
                    maxlength: 10,
                },
                mobile_number: {
                    required: true,
                    minlength: 10,
                },
				email: {
					email: true
				},
			},
			messages: {
				pincode: "pincode is not valid",
				email: "Please enter a valid email address",
				mobile_number: "mobile number is must be 10 digits",
				office_mobile: "mobile number is must be 10 digits"
			}
		});
	});
    </script>
    <script>
        $(document).ready(function () {
                $('#prefix, #state, #district, #donate, #blood, #id_sub_category, #id_category, #firmtype, #gender, #martial_status, #responsibility, #education, #employment, #income').select2({
                    theme: "bootstrap4",
                    placeholder: 'Select ',
                });
            });
    </script>
    <script>
        $(document).ready(function () {
            $('#id_products').select2({
                placeholder: 'Select ',
                tags: true,
                tokenSeparators: [','],
            });
        });
        $("#id_products").change(function () {
            const url = $("#idform").attr("data-cat-url");
            const pId = $(this).val();

            $.ajax({
                url: url,
                data: {
                    'product_id': pId
                },
                success: function (data) {
                    $("#id_sub_category").html(data);
                }
            });
        });
        $("#id_products").change(function () {
            const url = $("#idform").attr("data-p-url");
            const prId = $(this).val();

            $.ajax({
                url: url,
                data: {
                    'pr_id': prId
                },
                success: function (data) {
                    $("#id_category").html(data);
                }
            });
        });
    </script>
{% endblock %}